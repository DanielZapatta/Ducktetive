<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ducktetive | Dashboards</title>

    <link rel="stylesheet" href="../css/dashboards.css">
    <script src="../js/sessao.js"></script>
    <script src="./../js/alerta.js"></script>

    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link
        href="https://fonts.googleapis.com/css2?family=Exo+2:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
        rel="stylesheet">

    <!-- scripts do Chart.js - 2022-1 -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!--FONT AWESOME-->
    <script src="https://kit.fontawesome.com/9f7414eb10.js" crossorigin="anonymous"></script>
    <link rel="icon" href="../src\images\ducktetive.png ">

</head>

<!-- <body onload=" atualizarFeed()"> -->

<body onload="payload()">

    <main class="dashboard-main">
        <aside class="aside-bar-menu" style="">
            <div id="logo-ducktetive">
              <img src="../src/images/DUCKTETIVE2.png" id="duck-logo-dashboard" />
            </div>
            </a>
            <hr/>
        <div id="dashboard-menu">
            <div class="top-items">
                <div class="dash-item">
                    <a href="servidores.html">
                    <div class="menu">
                        <div class="icon">
                          <img src="../src/images/Dashboard/icons/servidores.png" alt="" class="icon-menu">
                        </div>
                      <p class="item-text">Servidores</p>
                    </div></a>
                </div>
                <div class="dash-item">
                    <div class="menu" id="selected">
                        <div class="icon">
                          <img src="../src/images/Dashboard/icons/servidores.png" alt="" class="icon-menu">
                        </div>
                      <p class="item-text">Dashboard</p>
                    </div>
                </div>
            </div>
            
              
              
              <div class="bottom-items">
                <div class="dash-item">
                  <a href="visualizarUsuarios.html">
                    <div class="menu">
                        <div class="icon">
                            <img src="../src/images/Dashboard/icons/do-utilizador 1.png" alt="" class="icon-menu">
                        </div>
                        <p class="item-text">Gerenciar contas</p>
                    </div>
                </a>
              </div>
              <div class="bottom-items">
                <div class="dash-item">
                  <a href="../alteracaoDeDados.html">
                  <div class="menu">
                      <div class="icon">
                          <img src="../src/images/Dashboard/icons/pessoas 1.png" alt="" class="icon-menu">
                      </div>
                      <p class="item-text">Editar conta</p>
                  </div></a>
              </div>
              <div class="bottom-items">
                <div class="dash-item">
                  <a href="../registroUsuario.html">
                  <div class="menu">
                      <div class="icon">
                          <img src="../src/images/Dashboard/icons/adicionar-usuario 1.png" alt="" class="icon-menu">
                      </div>
                      <p class="item-text">Criar usuario</p>
                  </div>
                </a>
              </div>
              <div class="bottom-items">
                <div class="dash-item">
                  <a href="../login.html">
                  <div class="menu" onclick="sessionStorage.clear()">
                      <div class="icon">
                          <img src="../src/images/Dashboard/icons/sair 1.png" alt="" class="icon-menu">
                      </div>
                      <p class="item-text">Logout</p>
                  </div></a>
              </div>
              
              </div>
          </aside>
        <section class="dashboard-content" id="dashboard-home" style="display: block;">
            
            <div class="dados-do-servidor">
                <div class="servHeader">
                  <div id="titulo-pagina">
                  <p class="titulo">Servidores da DUCKTETIVE</p>
                  <p class="subtitulo">Painel de gerenciamento de servidores</p>
                  </div>
                    <div class="servButtons">
                        <div class="buscar">
                          <input type="text" class="buscar">
                          <img src="../src/images/Dashboard/icons/lupa.png" id="imgLupa">
                        </div>
                        <div id="filtrarServidores">
                          <img src="../src/images/Dashboard/icons/contexto 1.png">
                        </div>
                        <div id="user-data" >
                          <img src="../src/images/Dashboard/userProfile.png" alt="" id="user_picture">
                        </div>
                        <div id="dadosUsuario">
                          <span id="b_usuario"></span><br>
                          <span id="cargo_usuario"></span>
                        </div>
                    </div>
              </div>
                
              </div>

            <div id="cards">

            
                <div class="cpu-cards">
                    <div class="KPI-cards">
                        <div class="CPU-cards-kpi">
                            <span class="kpi-title">
                                PROCESSADORES LÓGICOS
                            </span>
                            <span class="kpi-content">
                                4
                            </span>
                        </div>
                        <div class="CPU-cards-kpi">
                            <span class="kpi-title">
                                PROCESSADORES FÍSICOS
                            </span>
                            <span class="kpi-content">
                                2
                            </span>
                        </div>
                        <div class="CPU-cards-kpi" id="cpu-frequency">
                            <span class="kpi-title">
                                Percentual de uso
                            </span>
                            <span class="kpi-content">
                                86%
                            </span>
                        </div>
                    </div>
                    <div class="cpuCharts">
                        <div class="uso_cpu" style="width: 764px;">
                            <span>Uso de CPU</span>
                            <canvas id="uso_cpu" style="display: block; box-sizing: border-box; height: 500px; width: 1500px;"></canvas>
                        </div>

                    </div>
                </div>
                <div class="ramCharts">
                    <div class="KPI-ram">
                        <div class="CPU-cards-kpi">
                            <span class="kpi-title">
                                Total
                            </span>
                            <span class="kpi-content">
                                19.8GB
                            </span>
                        </div>
                        <div class="CPU-cards-kpi">
                            <span class="kpi-title">
                                Em uso
                            </span>
                            <span class="kpi-content">
                                10.2GB
                            </span>
                        </div>
                        <div class="CPU-cards-kpi" id="ram-frequency">
                            <span class="kpi-title">
                                Percentual de uso
                            </span>
                            <span class="kpi-content">
                                49%
                            </span>
                        </div>
                    </div>  
                    <span>Uso de RAM</span>

                    <div class="ram-use" style="width: 764px;">
                        <canvas id="uso_ramBarra" style="display: block; box-sizing: border-box; height: 200px; width: 1500px;"></canvas>
                    </div>
                    <span>Uso de RAM</span>

                    <div class="ram-use" style="width: 764px">
                        <canvas id="uso_ramLinha" style="display: block; box-sizing: border-box; height: 200px; width: 1500px;"></canvas>
                    </div>

                </div>

                <div class="discoCharts">
                    <div class="KPI-cards">
                        <div class="disco-cards-kpi">
                            <span class="kpi-content read-write">
                                Leitura : 4.2 MB/s
                            </span>
                            <span class="kpi-content read-write">
                                Escrita : 4.2 MB/s
                            </span>
                        </div>
                        <div class="disco-cards-kpi">
                            <span class="kpi-content read-write">
                                Total : 1 TB
                            </span>
                            <span class="kpi-content read-write">
                                Disponivel : 354 GBs
                            </span>
                            <span class="kpi-content read-write">
                                Percentual de uso: 35%
                            </span>
                            
                            
                        </div>
                        <div class="disco-cards-kpi" id="disco-frequency">
                            <span class="kpi-title">
                                Baseado em seu uso 
                            </span>
                            <span class="kpi-title">
                                Disco vai estourar em 
                            </span>
                            <span class="kpi-content">
                                10 dias
                            </span>
                    </div>
                    
                    </div>
                    <div class="cpuCharts">
                        <div class="cpu-use" style="width: 764px;">
                            <span>Uso de Disco</span>
                            <canvas id="uso_disco" style="display: block; box-sizing: border-box; height: 550px; width: 1350px;"></canvas>
                        </div>

                    </div>

                </div>

                <div class="redeCharts">
                    <div class="KPI-cards">
                        <div class="disco-cards-kpi">
                            <span class="kpi-content read-write">
                                Nome Rede:
                            </span>
                            <span class="kpi-content read-write">
                                Starbucks
                            </span>
                        </div>
                        
                        <div class="disco-cards-kpi" id="cpu-frequency">
                            <span class="kpi-title">
                                Pacotes Recebidos 
                            </span>
                            <span class="kpi-content">
                                369 
                            </span>
                    </div>
                    
                    </div>
                    <div class="cpuCharts">
                        <div class="cpu-use" style="width: 764px;">
                            <span>Uso de Rede</span>
                            <canvas id="uso_rede" style="display: block; box-sizing: border-box; height: 500px; width: 1500px;"></canvas>
                        </div>

                    </div>
                </div>
            </div>
        </section>
        <!-- CPU - KAIKY -->
        <section class="dashboard-content" id="dashboard-CPU" style="display: none;">
            <h2 class="dashboard-title">Overview California_Server - CPU</h2>
            <div class="cpu-content">
                <h3>AMD Ryzen 5 5500U- 8 cores 8 threads</h3>
                <div class="campo-grafico" id="campo_grafico">
                    <div class="graficos">
                        <canvas id="grafico_cpu"></canvas>
                    </div>
                </div>
                <div class="uso-cpu">
                    <div id="div_kpi_cpu">
                        <h1>Detalhes da Cpu</h1>
                        <div class="utilizacao-velocidade">
                            <span>
                                <p>
                                    Utilização:
                                </p>
                                <h3>20%</h3>
                            </span>
                            <span>
                                <p>
                                    Velocidade:
                                </p>
                                <h3>2.71 Ghz</h3>
                            </span>

                        </div>
                        <p>
                            Processos:
                        <h3>244</h3>
                        </p>
                        <p>
                            Tempo Ligado:
                        <h3>1:12:31:28</h3>
                        </p>
                        <span>
                            <div>
                                <span>
                                    <p>Velocidade base</p>
                                    <p><b>2.10 Ghz</b></p>
                                </span>
                                <span>
                                    <p>Cores</p>
                                    <p><b>8</b></p>
                                </span>

                                <span>
                                    <p>Threads</p>
                                    <p><b>8</b></p>
                                </span>

                                <span>
                                    <p>L1 Cache</p>
                                    <p><b>384 KB</b></p>
                                </span>

                                <span>
                                    <p>L2 Cache</p>
                                    <p><b>3.0 MB</b></p>
                                </span>

                                <span>
                                    <p>L3 Cache</p>
                                    <p><b>8.0 MB</b></p>
                                </span>
                            </div>
                        </span>
                    </div>
                    <div class="grafico-detalhes">
                        <canvas id="detalhes_cpu"></canvas>
                    </div>
                </div>
            </div>

        </section>

        <!-- RAM - ZAPATTA -->
        <section class="dashboard-content" id="dashboard-RAM" style="display: none;">
            <h2 class="dashboard-title">Overview California_Server - RAM</h2>
            <div class="conteudo-ram">
                <div class="area-grafico-ram">
                    <h3>Uso da memória</h3>
                    <div class="grafico-ram">
                        <canvas id="grafico-ram"
                            style="display: block; box-sizing: border-box; height: 300px; width: 1200px;"></canvas>
                    </div>
                </div>
                <div class="indicadores-grafico-ram">
                    <div class="indicadores-ram">
                        <h3>Detalhes da memória</h3>
                        <div class="indicadores-medicao">
                            <span>
                                <p>
                                    Capacidade:
                                </p>
                                <h3>128 GB</h3>
                            </span>
                            <span>
                                <p>
                                    Em uso:
                                </p>
                                <h3>102,4 GB</h3>
                            </span>
                            <span>
                                <p>
                                    Disponível:
                                </p>
                                <h3>25,6 GB</h3>
                            </span>
                        </div>
                        <span>
                            <p>
                                Em cache:
                            </p>
                            <h3>12,3 GB</h3>
                        </span>
                        <span>
                            <p>
                                Processos em fila:
                            </p>
                            <h3>2500</h3>
                        </span>
                        <span>
                            <p>
                                Frequência:
                            </p>
                            <h3>6400 Mhz</h3>
                        </span>
                        <span>
                            <p>
                                Porcentagem de uso:
                            </p>
                            <h3>80%</h3>
                        </span>
                        </span>
                    </div>
                    <div class="grafico-barra-individual1">
                        <span>Memória 1:</span>
                        <canvas id="grafico1-ram-barra"
                            style="display: block; box-sizing: border-box; height: 370px; width: 160px;"></canvas>
                    </div>
                    <div class="grafico-barra-individual2">
                        <span>Memória 2:</span>
                        <canvas id="grafico2-ram-barra"
                            style="display: block; box-sizing: border-box; height: 370px; width: 160px;"></canvas>
                    </div>
                </div>
            </div>

        </section>

        <!-- ARMAZENAMENTO - ZAPATTA -->
        <section class="dashboard-content" id="dashboard-HD" style="display: none;">
            <h2 class="dashboard-title">Overview California_Server - HD</h2>
            <div class="conteudo-armazenamento">
                <div class="area-grafico01-armazenamento">
                    <h2>Uso do armazenamento</h2>
                    <div class="armazenamento-grafico01">
                        <canvas id="grafico01-armazenamento"
                            style="display: block; box-sizing: border-box; height: 300px; width: 1200px;"></canvas>
                    </div>
                </div>
                <div class="area-grafico02-armazenamento">
                    <h2>Taxa de transferência de disco</h2>
                    <div class="armazenamento-grafico02">
                        <canvas id="grafico02-armazenamento"
                            style="display: block; box-sizing: border-box; height: 100px; width: 1200px;"></canvas>
                    </div>
                </div>
                <div class="area-bottom-indicadores-grafico03">
                    <div class="indicadores">
                        <div class="indicadores-titulo">
                            <h2>Detalhes do armazenamento</h2>
                        </div>
                        <div class="indicadores-armazenamento">
                            <div class="dados-indicadores">
                                <span>
                                    <p>
                                        Capacidade:
                                    </p>
                                    <h3>9.768 GB</h3>
                                </span>
                                <span>
                                    <p>
                                        Em uso:
                                    </p>
                                    <h3>7.170 GB</h3>
                                </span>
                                <span>
                                    <p>
                                        Disponível:
                                    </p>
                                    <h3>73,4% / 2.598 GB</h3>
                                </span>
                                <span>
                                    <p>
                                        Tempo de atividade:
                                    </p>
                                    <h3>70%</h3>
                                </span>
                                <span>
                                    <p>
                                        Taxa de transferência:
                                    </p>
                                    <h3>600 Kb/s</h3>
                                </span>
                                <span>
                                    <p>
                                        Velocidade de leitura:
                                    </p>
                                    <h3>30 Kb/s</h3>
                                </span>
                                <span>
                                    <p>
                                        Velogicade de gravação:
                                    </p>
                                    <h3>472 Kb/s</h3>
                                </span>
                                <span>
                                    <p>
                                        Tipo:
                                    </p>
                                    <h3>SSD M.2 NVMe</h3>
                                </span>
                            </div>
                        </div>
                    </div>
                    <div class="area-grafico03-armazenamento">
                        <h2>Taxa de transferência de disco</h2>
                        <canvas id="grafico03-armazenamento"
                            style="display: block; box-sizing: border-box; height: 200px; width: 700px;"></canvas>
                    </div>
                </div>

            </div>
        </section>

        <!-- REDE - GUSTAVO -->
        <section class="dashboard-content" id="dashboard-REDE" style="display: none;">
            <h2 class="dashboard-title">Overview California_Server - REDE</h2>
            <div class="dash-uso-rede">
                <div id="div_kpi_rede">
                    <h2>Detalhes da rede</h2>
                    <p>
                        Frequência:
                    <h3>5.0 Ghz</h3>
                    </p>
                    <p>
                        Tipo de conexão:
                    <h3>Ethernet</h3>
                    </p>
                    <p>
                        Velocidade de Download:
                    <h3>5000Mb/ps</h3>
                    </p>
                    <p>
                        Velociade de Upload:
                    <h3>4000Mb/ps</h3>
                    </p>
                    <h2>Dados</h2>
                    <span>
                        <div>
                            <p>Enviados:</p>
                            <h3>3500Mb/ps</h3>
                        </div>
                        <div>
                            <p>Recebidos:</p>
                            <h3>4300Mb/ps</h3>
                        </div>
                    </span>
                </div>
                <div>
                    <canvas id="grafico-rede" class="canvas-rede"></canvas>
                </div>
            </div>
        </section>

    </main>

    <!-- <script src="../js/dashDinamica.js"></script>  -->
  <!--<script src="../js/graficos.js"></script>-->
</body>

</html>

<script>    

    function payload(){
        const NOME_USUARIO = sessionStorage.NOME_USUARIO;
        const SOBRENOME_NOME_USUARIO = sessionStorage.SOBRENOME_NOME_USUARIO;
        const CARGO_USUARIO = sessionStorage.CARGO_USUARIO;
        const NOME_FANTASIA_USUARIO = sessionStorage.NOME_FANTASIA_USUARIO;
        b_usuario.innerHTML = `${NOME_USUARIO.toUpperCase()} ${SOBRENOME_NOME_USUARIO.toUpperCase()}`;
        cargo_usuario.innerHTML = `${CARGO_USUARIO.toUpperCase()} - ${NOME_FANTASIA_USUARIO.toUpperCase()}`;
    
        b_usuario.innerHTML = `${NOME_USUARIO}`;
        cargo_usuario.innerHTML = `${CARGO_USUARIO}`;
        
    if (CARGO_USUARIO.toUpperCase() != "DONO"){
        document.getElementById("criarUsuario").style.display = "none";
    }

    const pegaURL = new URL(window.location)
    const id = pegaURL.searchParams.get('id')
    console.log(`servidor ${id}`)
    //buscarUltimasMedidas(id)
    obterDadosGraficoCPU(id)
    obterDadosGraficoRAM(id)
    obterDadosGraficoRAMlinha(id)
    obterDadosGraficoDisco(id)
    obterDadosGraficoRede(id)
    
    var baseStr64 = sessionStorage.FOTO_PERFIL;
    user_picture.setAttribute('src', "data:image/jpg;base64," + baseStr64);

    }

    // function buscarUltimasMedidasCPU(id) {
    //     var idServidorVar = id;

    //     if (
    //     idServidorVar == ""
    //   ) {
    //     alertify.error('Escreva os dados em todos os campos');
    //     return false;
    //   } 
  
    //   fetch("/medidas/buscarUltimasMedidasCPU", {
    //     method: "POST",
    //     headers: {
    //       "Content-Type": "application/json",
    //     },
    //     body: JSON.stringify({
    //       idServidorServer:idServidorVar
    //     }),
    //   })
    //     .then(function (resposta) {
    //       console.log("resposta: ", resposta);
  
    //       if (resposta.ok) {
    //         console.log('dados corretos')
    //       } else {
    //         console.log('Ocorreu um erro com a atualização dos dados')
    //       }
    //     })
    //     .catch(function (resposta) {
    //       console.log(`#ERRO: ${resposta}`);

    //     });
  
    //   return false;
    // }
  

// Dados CPU

function obterDadosGraficoCPU(idMetrica) {
    var idServidorVar = idMetrica
  fetch(`/medidas/buscarUltimasMedidasCPU`, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        idServidorServer: idServidorVar,
      }),
    })
    .then(function (response) {
      if (response.ok) {
        response.json().then(function (resposta) {
          console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
          resposta.reverse();

          plotarGraficoCPU(resposta, idMetrica);
        });
      } else {
        console.error("Nenhum dado encontrado ou erro na API");
      }
    })
    .catch(function (error) {
      console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
    });
}

function plotarGraficoCPU(resposta, idMetrica) {
  console.log("iniciando plotagem do gráfico...");

  // Criando estrutura para plotar gráfico - labels
  let labels = [];

  // Criando estrutura para plotar gráfico - dados
  let dados = {
    labels: labels,
    datasets: [
      {
        label: "CPU",
        data: [],
        fill: false,
        borderColor: "rgba(255,124,51,1)",
        tension: 0.7,
        borderWidth: 4
      },
    ],
  };

  console.log("----------------------------------------------");
  console.log(
    'Estes dados foram recebidos pela funcao "obterDadosGrafico" e passados para "plotarGrafico":'
  );
  console.log(resposta);

  // Inserindo valores recebidos em estrutura para plotar o gráfico
  for (i = 0; i < resposta.length; i++) {
    var registro = resposta[i];
    labels.push(registro.momento_grafico);
    dados.datasets[0].data.push(registro.valor);
    // dados.datasets[1].data.push(registro.temperatura);
  }

  console.log("----------------------------------------------");
  console.log("O gráfico será plotado com os respectivos valores:");
  console.log("Labels:");
  console.log(labels);
  console.log("Dados:");
  console.log(dados.datasets);
  console.log("----------------------------------------------");

  // Criando estrutura para plotar gráfico - configCPU
  const configCPU = {
    type: "line",
    data: dados,
  };

  // Adicionando gráfico criado em div na tela
  let myChartCPU = new Chart(document.getElementById(`uso_cpu`), configCPU);

  setTimeout(() => atualizarGraficoCPU(idMetrica, dados, myChartCPU), 2000);
}

function atualizarGraficoCPU(idMetrica, dados, myChartCPU) {
    var idServidorVar = idMetrica
  fetch(`/medidas/buscarMedidasEmTempoRealCPU`, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        idServidorServer: idServidorVar,
      }),
    }).then(function (response) {
      if (response.ok) {
        response.json().then(function (novoRegistro) {
          //obterdados(idMetrica);;
          // alertar(novoRegistro, idMetrica);
          console.log(`Dados recebidos: ${JSON.stringify(novoRegistro)}`);
          console.log(`Dados atuais do gráfico:`);
          console.log(dados);

          if (
            novoRegistro[0].momento_grafico ==
            dados.labels[dados.labels.length - 1]
          ) {
            console.log(
              "---------------------------------------------------------------"
            );
            console.log(
              "Como não há dados novos para captura, o gráfico não atualizará."
            );
            console.log("Horário do novo dado capturado:");
            console.log(novoRegistro[0].momento_grafico);
            console.log("Horário do último dado capturado:");
            console.log(dados.labels[dados.labels.length - 1]);
            console.log(
              "---------------------------------------------------------------"
            );
          } else {
            // tirando e colocando valores no gráfico
            dados.labels.shift(); // apagar o primeiro
            dados.labels.push(novoRegistro[0].momento_grafico); // incluir um novo momento

            dados.datasets[0].data.shift(); // apagar o primeiro de umidade
            dados.datasets[0].data.push(novoRegistro[0].valor); // incluir uma nova medida de umidade

            //  dados.datasets[1].data.shift();  // apagar o primeiro de temperatura
            //  dados.datasets[1].data.push(novoRegistro[0].temperatura); // incluir uma nova medida de temperatura

            myChartCPU.update();
          }

          // Altere aqui o valor em ms se quiser que o gráfico atualize mais rápido ou mais devagar
          proximaAtualizacao = setTimeout(
            () => atualizarGraficoCPU(idMetrica, dados, myChartCPU),
            2000
          );
        });
      } else {
        console.error("Nenhum dado encontrado ou erro na API");
        // Altere aqui o valor em ms se quiser que o gráfico atualize mais rápido ou mais devagar
        proximaAtualizacao = setTimeout(
          () => atualizarGraficoCPU(idMetrica, dados, myChartCPU),
          2000
        );
      }
    })
    .catch(function (error) {
      console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
    });
}

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Graficos RAM deitado

function obterDadosGraficoRAM(idMetrica) {
    var idServidorVar = idMetrica
  fetch(`/medidas/buscarUltimasMedidasRAM`, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        idServidorServer: idServidorVar,
      }),
    }).then(function (response) {
      if (response.ok) {
        response.json().then(function (resposta) {
          console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
          resposta.reverse();

          plotarGraficoRAM(resposta, idMetrica);
        });
      } else {
        console.error("Nenhum dado encontrado ou erro na API");
      }
    })
    .catch(function (error) {
      console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
    });
}

function plotarGraficoRAM(resposta, idMetrica) {
  console.log("iniciando plotagem do gráfico...");

  // Criando estrutura para plotar gráfico - labels
  let labels = [];

  // Criando estrutura para plotar gráfico - dados
  let dados = {
    labels: labels,
    datasets: [
    {
        data: [],
        backgroundColor: "rgba(255, 99, 132, 0.2)", // Cor de fundo para a barra
        borderColor: "rgba(255, 99, 132)", // Cor da borda da barra
        borderWidth: 1,
      },
      {
        data: [],
        backgroundColor: "rgba(54, 162, 235)", // Cor de fundo para a barra
        borderColor: "rgba(54, 162, 235)", // Cor da borda da barra
        borderWidth: 1,
      },
    ],
  };

  console.log("----------------------------------------------");
  console.log(
    'Estes dados foram recebidos pela funcao "obterDadosGrafico" e passados para "plotarGrafico":'
  );
  console.log(resposta);

  // Inserindo valores recebidos em estrutura para plotar o gráfico
  for (i = 0; i < resposta.length; i++) {
    var registro = resposta[i];
    labels.push(registro.momento_grafico);
    dados.datasets[0].data.push(registro.valor);
    // dados.datasets[1].data.push(registro.temperatura);
  }

  console.log("----------------------------------------------");
  console.log("O gráfico será plotado com os respectivos valores:");
  console.log("Labels:");
  console.log(labels);
  console.log("Dados:");
  console.log(dados.datasets);
  console.log("----------------------------------------------");

  // Criando estrutura para plotar gráfico - configCPU
  const configRAMdeitada = {
    type: "bar",
    data: dados,
    options: {
    indexAxis: "y", // Mudança para o eixo y para sobrepor as barras
    barPercentage: -100, // Ajuste para sobrepor as barras
    scales: {
      x: {
        beginAtZero: true,
      },
      y: {
        beginAtZero: true,
        max: 100,
      },
    },
  },
  };

  // Adicionando gráfico criado em div na tela
  let myChartRAMdeitada = new Chart(
    document.getElementById(`uso_ramBarra`),
    configRAMdeitada
  );

  setTimeout(
    () => atualizarGraficoRAM(idMetrica, dados, myChartRAMdeitada),
    2000
  );
}

function atualizarGraficoRAM(idMetrica, dados, myChartRAMdeitada) {
    var idServidorVar = idMetrica
  fetch(`/medidas/buscarMedidasEmTempoRealRAM`, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        idServidorServer: idServidorVar,
      }),
    }).then(function (response) {
      if (response.ok) {
        response.json().then(function (novoRegistro) {
          //obterdados(idMetrica);;
          // alertar(novoRegistro, idMetrica);
          console.log(`Dados recebidos: ${JSON.stringify(novoRegistro)}`);
          console.log(`Dados atuais do gráfico:`);
          console.log(dados);

          if (
            novoRegistro[0].momento_grafico ==
            dados.labels[dados.labels.length - 1]
          ) {
            console.log(
              "---------------------------------------------------------------"
            );
            console.log(
              "Como não há dados novos para captura, o gráfico não atualizará."
            );
            console.log("Horário do novo dado capturado:");
            console.log(novoRegistro[0].momento_grafico);
            console.log("Horário do último dado capturado:");
            console.log(dados.labels[dados.labels.length - 1]);
            console.log(
              "---------------------------------------------------------------"
            );
          } else {
            // tirando e colocando valores no gráfico
            dados.labels.shift(); // apagar o primeiro
            dados.labels.push(novoRegistro[0].momento_grafico); // incluir um novo momento

            dados.datasets[0].data.shift(); // apagar o primeiro de umidade
            dados.datasets[0].data.push(novoRegistro[0].valor); // incluir uma nova medida de umidade

            //  dados.datasets[1].data.shift();  // apagar o primeiro de temperatura
            //  dados.datasets[1].data.push(novoRegistro[0].temperatura); // incluir uma nova medida de temperatura

            myChartRAMdeitada.update();
          }

          // Altere aqui o valor em ms se quiser que o gráfico atualize mais rápido ou mais devagar
          proximaAtualizacao = setTimeout(
            () => atualizarGraficoRAM(idMetrica, dados, myChartRAMdeitada),
            2000
          );
        });
      } else {
        console.error("Nenhum dado encontrado ou erro na API");
        // Altere aqui o valor em ms se quiser que o gráfico atualize mais rápido ou mais devagar
        proximaAtualizacao = setTimeout(
          () => atualizarGraficoRAM(idMetrica, dados, myChartRAMdeitada),
          2000
        );
      }
    })
    .catch(function (error) {
      console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
    });
}

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// ram linha

function obterDadosGraficoRAMlinha(idMetrica) {
    var idServidorVar = idMetrica
  fetch(`/medidas/buscarUltimasMedidasRAM`, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        idServidorServer: idServidorVar,
      }),
    }).then(function (response) {
      if (response.ok) {
        response.json().then(function (resposta) {
          console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
          resposta.reverse();

          plotarGraficoRAMlinha(resposta, idMetrica);
        });
      } else {
        console.error("Nenhum dado encontrado ou erro na API");
      }
    })
    .catch(function (error) {
      console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
    });
}

function plotarGraficoRAMlinha(resposta, idMetrica) {
  console.log("iniciando plotagem do gráfico...");

  // Criando estrutura para plotar gráfico - labels
  let labels = [];

  // Criando estrutura para plotar gráfico - dados
  let dados = {
    labels: labels,
    datasets: [
      {
        label: "RAM",
        data: [],
        fill: false,
        borderColor: "rgba(255,124,51,1)",
        tension: 0.7,
        borderWidth: 4
      },
    ],
  };

  console.log("----------------------------------------------");
  console.log(
    'Estes dados foram recebidos pela funcao "obterDadosGrafico" e passados para "plotarGrafico":'
  );
  console.log(resposta);

  // Inserindo valores recebidos em estrutura para plotar o gráfico
  for (i = 0; i < resposta.length; i++) {
    var registro = resposta[i];
    labels.push(registro.momento_grafico);
    dados.datasets[0].data.push(registro.valor);
    // dados.datasets[1].data.push(registro.temperatura);
  }

  console.log("----------------------------------------------");
  console.log("O gráfico será plotado com os respectivos valores:");
  console.log("Labels:");
  console.log(labels);
  console.log("Dados:");
  console.log(dados.datasets);
  console.log("----------------------------------------------");

  // Criando estrutura para plotar gráfico - configCPU
  const configRAMlinha = {
    type: "line",
    data: dados,
  };

  // Adicionando gráfico criado em div na tela
  let myChartRAMlinha = new Chart(
    document.getElementById(`uso_ramLinha`),
    configRAMlinha
  );

  setTimeout(
    () => atualizarGraficoRAMlinha(idMetrica, dados, myChartRAMlinha),
    2000
  );
}

function atualizarGraficoRAMlinha(idMetrica, dados, myChartRAMlinha) {
    var idServidorVar = idMetrica
  fetch(`/medidas/buscarMedidasEmTempoRealRAM`, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        idServidorServer: idServidorVar,
      }),
    }).then(function (response) {
      if (response.ok) {
        response.json().then(function (novoRegistro) {
          //obterdados(idMetrica);;
          // alertar(novoRegistro, idMetrica);
          console.log(`Dados recebidos: ${JSON.stringify(novoRegistro)}`);
          console.log(`Dados atuais do gráfico:`);
          console.log(dados);

          if (
            novoRegistro[0].momento_grafico ==
            dados.labels[dados.labels.length - 1]
          ) {
            console.log(
              "---------------------------------------------------------------"
            );
            console.log(
              "Como não há dados novos para captura, o gráfico não atualizará."
            );
            console.log("Horário do novo dado capturado:");
            console.log(novoRegistro[0].momento_grafico);
            console.log("Horário do último dado capturado:");
            console.log(dados.labels[dados.labels.length - 1]);
            console.log(
              "---------------------------------------------------------------"
            );
          } else {
            // tirando e colocando valores no gráfico
            dados.labels.shift(); // apagar o primeiro
            dados.labels.push(novoRegistro[0].momento_grafico); // incluir um novo momento

            dados.datasets[0].data.shift(); // apagar o primeiro de umidade
            dados.datasets[0].data.push(novoRegistro[0].valor); // incluir uma nova medida de umidade

            //  dados.datasets[1].data.shift();  // apagar o primeiro de temperatura
            //  dados.datasets[1].data.push(novoRegistro[0].temperatura); // incluir uma nova medida de temperatura

            myChartRAMlinha.update();
          }

          // Altere aqui o valor em ms se quiser que o gráfico atualize mais rápido ou mais devagar
          proximaAtualizacao = setTimeout(
            () => atualizarGraficoRAMlinha(idMetrica, dados, myChartRAMlinha),
            2000
          );
        });
      } else {
        console.error("Nenhum dado encontrado ou erro na API");
        // Altere aqui o valor em ms se quiser que o gráfico atualize mais rápido ou mais devagar
        proximaAtualizacao = setTimeout(
          () => atualizarGraficoRAMlinha(idMetrica, dados, myChartRAMlinha),
          2000
        );
      }
    })
    .catch(function (error) {
      console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
    });
}

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// grafico disco

function obterDadosGraficoDisco(idMetrica) {
    var idServidorVar = idMetrica
  fetch(`/medidas/buscarUltimasMedidasDISCO`, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        idServidorServer: idServidorVar,
      }),
    }).then(function (response) {
      if (response.ok) {
        response.json().then(function (resposta) {
          console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
          resposta.reverse();

          plotarGraficoDisco(resposta, idMetrica);
        });
      } else {
        console.error("Nenhum dado encontrado ou erro na API");
      }
    })
    .catch(function (error) {
      console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
    });
}

function plotarGraficoDisco(resposta, idMetrica) {
  console.log("iniciando plotagem do gráfico...");

  // Criando estrutura para plotar gráfico - labels
  let labels = [];

  // Criando estrutura para plotar gráfico - dados
  let dados = {
    labels: labels,
    datasets: [
      {
        label: "Disco",
        data: [],
        fill: false,
        borderColor: "rgba(255,124,51,1)",
        tension: 0.7,
        borderWidth: 4
      },
    ],
  };

  console.log("----------------------------------------------");
  console.log(
    'Estes dados foram recebidos pela funcao "obterDadosGrafico" e passados para "plotarGrafico":'
  );
  console.log(resposta);

  // Inserindo valores recebidos em estrutura para plotar o gráfico
  for (i = 0; i < resposta.length; i++) {
    var registro = resposta[i];
    labels.push(registro.momento_grafico);
    dados.datasets[0].data.push(registro.valor);
    // dados.datasets[1].data.push(registro.temperatura);
  }

  console.log("----------------------------------------------");
  console.log("O gráfico será plotado com os respectivos valores:");
  console.log("Labels:");
  console.log(labels);
  console.log("Dados:");
  console.log(dados.datasets);
  console.log("----------------------------------------------");

  // Criando estrutura para plotar gráfico - configCPU
  const configDisco = {
    type: "line",
    data: dados,
  };

  // Adicionando gráfico criado em div na tela
  let myChartDisco = new Chart(
    document.getElementById(`uso_disco`),
    configDisco
  );

  setTimeout(() => atualizarGraficoDisco(idMetrica, dados, myChartDisco), 2000);
}

function atualizarGraficoDisco(idMetrica, dados, myChartDisco) {
    var idServidorVar = idMetrica
  fetch(`/medidas/buscarMedidasEmTempoRealDISCO`, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        idServidorServer: idServidorVar,
      }),
    }).then(function (response) {
      if (response.ok) {
        response.json().then(function (novoRegistro) {
          //obterdados(idMetrica);;
          // alertar(novoRegistro, idMetrica);
          console.log(`Dados recebidos: ${JSON.stringify(novoRegistro)}`);
          console.log(`Dados atuais do gráfico:`);
          console.log(dados);

          if (
            novoRegistro[0].momento_grafico ==
            dados.labels[dados.labels.length - 1]
          ) {
            console.log(
              "---------------------------------------------------------------"
            );
            console.log(
              "Como não há dados novos para captura, o gráfico não atualizará."
            );
            console.log("Horário do novo dado capturado:");
            console.log(novoRegistro[0].momento_grafico);
            console.log("Horário do último dado capturado:");
            console.log(dados.labels[dados.labels.length - 1]);
            console.log(
              "---------------------------------------------------------------"
            );
          } else {
            // tirando e colocando valores no gráfico
            dados.labels.shift(); // apagar o primeiro
            dados.labels.push(novoRegistro[0].momento_grafico); // incluir um novo momento

            dados.datasets[0].data.shift(); // apagar o primeiro de umidade
            dados.datasets[0].data.push(novoRegistro[0].valor); // incluir uma nova medida de umidade

            //  dados.datasets[1].data.shift();  // apagar o primeiro de temperatura
            //  dados.datasets[1].data.push(novoRegistro[0].temperatura); // incluir uma nova medida de temperatura

            myChartDisco.update();
          }

          // Altere aqui o valor em ms se quiser que o gráfico atualize mais rápido ou mais devagar
          proximaAtualizacao = setTimeout(
            () => atualizarGraficoDisco(idMetrica, dados, myChartDisco),
            2000
          );
        });
      } else {
        console.error("Nenhum dado encontrado ou erro na API");
        // Altere aqui o valor em ms se quiser que o gráfico atualize mais rápido ou mais devagar
        proximaAtualizacao = setTimeout(
          () => atualizarGraficoDisco(idMetrica, dados, myChartDisco),
          2000
        );
      }
    })
    .catch(function (error) {
      console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
    });
}

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// grafico REDE

function obterDadosGraficoRede(idMetrica) {
    var idServidorVar = idMetrica
  fetch(`/medidas/buscarUltimasMedidasREDE`, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        idServidorServer: idServidorVar,
      }),
    }).then(function (response) {
      if (response.ok) {
        response.json().then(function (resposta) {
          console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
          resposta.reverse();

          plotarGraficoRede(resposta, idMetrica);
        });
      } else {
        console.error("Nenhum dado encontrado ou erro na API");
      }
    })
    .catch(function (error) {
      console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
    });
}

function plotarGraficoRede(resposta, idMetrica) {
  console.log("iniciando plotagem do gráfico...");

  // Criando estrutura para plotar gráfico - labels
  let labels = [];

  // Criando estrutura para plotar gráfico - dados
  let dados = {
    labels: labels,
    datasets: [
      {
        label: "Rede",
        data: [],
        borderColor:'rgba(255,124,51,1)',
        backgroundColor: [
        'rgba(255,124,51,1)',
        '#ffff'
     ],
        tension: 0.7,
      },
      {
      hoverOffset: 4
      }
    ],
  };

  console.log("----------------------------------------------");
  console.log(
    'Estes dados foram recebidos pela funcao "obterDadosGrafico" e passados para "plotarGrafico":'
  );
  console.log(resposta);

  // Inserindo valores recebidos em estrutura para plotar o gráfico
  for (i = 0; i < resposta.length; i++) {
    var registro = resposta[i];
    dados.datasets[0].data.push(registro.Porcentagem_USO);
    dados.datasets[0].data.push(registro.Resto)
    // dados.datasets[1].data.push(registro.temperatura);
  }

  console.log("----------------------------------------------");
  console.log("O gráfico será plotado com os respectivos valores:");
  console.log("Labels:");
  console.log(labels);
  console.log("Dados:");
  console.log(dados.datasets);
  console.log("----------------------------------------------");

  // Criando estrutura para plotar gráfico - configCPU
  const configRede = {
    type: "doughnut",
    data: dados,
    options: {
    max: 100,
  },
  };

  // Adicionando gráfico criado em div na tela
  let myChartRede = new Chart(document.getElementById(`uso_rede`), configRede);

  setTimeout(() => atualizarGraficoRede(idMetrica, dados, myChartRede), 2000);
}

function atualizarGraficoRede(idMetrica, dados, myChartRede) {
    var idServidorVar = idMetrica
  fetch(`/medidas/buscarMedidasEmTempoRealREDE`, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        idServidorServer: idServidorVar,
      }),
    }).then(function (response) {
      if (response.ok) {
        response.json().then(function (novoRegistro) {
          //obterdados(idMetrica);;
          // alertar(novoRegistro, idMetrica);
          console.log(`Dados recebidos: ${JSON.stringify(novoRegistro)}`);
          console.log(`Dados atuais do gráfico:`);
          console.log(dados);

          if (
            novoRegistro[0].momento_grafico ==
            dados.labels[dados.labels.length - 1]
          ) {
            console.log(
              "---------------------------------------------------------------"
            );
            console.log(
              "Como não há dados novos para captura, o gráfico não atualizará."
            );
            console.log("Horário do novo dado capturado:");
            console.log(novoRegistro[0].momento_grafico);
            console.log("Horário do último dado capturado:");
            console.log(dados.labels[dados.labels.length - 1]);
            console.log(
              "---------------------------------------------------------------"
            );
          } else {
            // tirando e colocando valores no gráfico
            dados.labels.shift(); // apagar o primeiro
            dados.labels.push(novoRegistro[0].momento_grafico); // incluir um novo momento

            dados.datasets[0].data.shift(); // apagar o primeiro de umidade
            dados.datasets[0].data.push(novoRegistro[0].Porcentagem_USO); 
            
            dados.datasets[0].data.shift(); // apagar o primeiro de umidade
            dados.datasets[0].data.push(novoRegistro[0].Resto);

            //  dados.datasets[1].data.shift();  // apagar o primeiro de temperatura
            //  dados.datasets[1].data.push(novoRegistro[0].temperatura); // incluir uma nova medida de temperatura

            myChartRede.update();
          }

          // Altere aqui o valor em ms se quiser que o gráfico atualize mais rápido ou mais devagar
          proximaAtualizacao = setTimeout(
            () => atualizarGraficoRede(idMetrica, dados, myChartRede),
            2000
          );
        });
      } else {
        console.error("Nenhum dado encontrado ou erro na API");
        // Altere aqui o valor em ms se quiser que o gráfico atualize mais rápido ou mais devagar
        proximaAtualizacao = setTimeout(
          () => atualizarGraficoRede(idMetrica, dados, myChartRede),
          2000
        );
      }
    })
    .catch(function (error) {
      console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
    });
}

</script>